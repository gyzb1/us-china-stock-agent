# 新星公司追踪功能

## 🌟 功能概述

**新功能**：追踪并展示首次进入成交额Top 30的公司

**目的**：
- 发现市场新热点
- 及时捕捉投资机会
- 追踪异常成交活跃的公司

---

## 🎯 功能特点

### 1. 自动检测
- ✅ 每次运行自动检测Top 30公司
- ✅ 识别首次出现的新公司
- ✅ 记录首次出现的日期、排名、成交额

### 2. 历史追踪
- ✅ 本地文件存储历史记录
- ✅ 永久记录所有曾出现的公司
- ✅ 支持查询最近N天的新公司

### 3. 完整分析
- ✅ 与Top 15相同的分析维度
- ✅ 业务描述
- ✅ A股/港股映射
- ✅ AI新闻总结
- ✅ 涨跌幅排序

### 4. 独立展示
- ✅ 单独的"新星公司"板块
- ✅ 绿色主题突出显示
- ✅ 与Top 15明确分隔

---

## 📊 工作原理

### 检测流程

```
1. 获取Top 30公司
   ↓
2. 读取历史记录
   ↓
3. 对比识别新公司
   ↓
4. 记录新公司信息
   ↓
5. 获取详细数据和新闻
   ↓
6. AI总结新闻
   ↓
7. 按涨跌幅排序
   ↓
8. 展示在独立板块
```

### 历史记录结构

```json
{
  "lastUpdate": "2025-10-30T14:58:00.000Z",
  "symbols": ["AAPL", "MSFT", "NVDA", ...],
  "records": [
    {
      "symbol": "NEWCO",
      "firstSeenDate": "2025-10-30",
      "firstSeenRank": 25,
      "firstSeenVolume": 5000000000
    }
  ]
}
```

---

## 🎨 UI设计

### 新星公司板块

```
┌─────────────────────────────────────────┐
│ 🌟 新星公司 - 首次进入Top 30            │
│                                         │
│ 以下公司首次出现在成交额前30名，        │
│ 值得重点关注！                          │
└─────────────────────────────────────────┘

┌──────────┐ ┌──────────┐ ┌──────────┐
│ NEWCO1   │ │ NEWCO2   │ │ NEWCO3   │
│ +8.5%    │ │ +5.2%    │ │ +3.1%    │
│          │ │          │ │          │
│ 业务描述  │ │ 业务描述  │ │ 业务描述  │
│ A股映射  │ │ A股映射  │ │ A股映射  │
│ 新闻总结  │ │ 新闻总结  │ │ 新闻总结  │
└──────────┘ └──────────┘ └──────────┘

─────────────────────────────────────────

📊 成交额Top 15（按涨跌幅排序）

成交额最大的15家公司，按涨跌幅从高到低排序
```

---

## 🔧 技术实现

### 1. 历史追踪器 (`lib/history-tracker.ts`)

**核心函数**：

```typescript
// 检测新进入的公司
detectNewEntrants(currentTop30)

// 获取今天的新公司
getTodayNewEntrants()

// 获取最近N天的新公司
getRecentNewEntrants(days)

// 清除历史记录（测试用）
clearHistory()
```

**存储位置**：
- `data/top30-history.json`
- 自动创建目录
- Git忽略（不提交）

### 2. API端点 (`/api/new-entrants`)

**功能**：
1. 获取Top 30公司
2. 检测新进入的公司
3. 获取详细信息和新闻
4. AI总结新闻
5. 按涨跌幅排序
6. 返回结果

**响应格式**：
```json
{
  "success": true,
  "data": [...],  // 股票详细信息
  "newEntrants": [...],  // 新进入记录
  "count": 2,
  "timestamp": "2025-10-30T14:58:00.000Z"
}
```

### 3. 前端组件 (`app/page.tsx`)

**新增状态**：
```typescript
const [newEntrants, setNewEntrants] = useState([]);
const [loadingNewEntrants, setLoadingNewEntrants] = useState(false);
```

**新增函数**：
```typescript
const fetchNewEntrants = async () => {
  // 获取新进入的公司
};
```

**UI组件**：
- 新星公司板块（绿色主题）
- 加载状态
- 分隔线
- Top 15板块（蓝色主题）

---

## 📈 使用场景

### 场景1：发现新热点

```
今日新进入Top 30：
- NEWCO: AI芯片新秀
- 首次排名：第25名
- 成交额：50亿美元
- 涨幅：+15.2%

→ 市场关注度突然提升
→ 可能有重大利好消息
→ 值得深入研究
```

### 场景2：追踪异常活跃

```
连续3天新进入：
- Day 1: STOCK1 (排名28)
- Day 2: STOCK2 (排名22)
- Day 3: STOCK3 (排名19)

→ 市场热度持续
→ 板块轮动信号
→ 关注行业趋势
```

### 场景3：风险警示

```
突然进入Top 30：
- RISKCO: 暴跌公司
- 排名：第15名
- 成交额：80亿美元
- 跌幅：-25.3%

→ 恐慌性抛售
→ 成交额异常放大
→ 风险警示信号
```

---

## 🎯 价值分析

### 投资价值

1. **早期发现**
   - 在公司进入Top 30时就发现
   - 比等到Top 15更早
   - 更多时间研究和决策

2. **热点追踪**
   - 市场关注度突然提升
   - 成交额异常放大
   - 可能有重大事件

3. **风险识别**
   - 暴跌导致的成交放大
   - 及时风险警示
   - 避免盲目跟风

### 信息价值

1. **完整分析**
   - 业务描述
   - A股映射
   - AI新闻总结

2. **对比参考**
   - 与Top 15对比
   - 了解市场结构
   - 发现投资机会

3. **历史追踪**
   - 记录首次出现
   - 追踪发展轨迹
   - 分析成长性

---

## 📊 数据统计

### 历史记录

**存储内容**：
- 所有曾出现的公司代码
- 首次出现日期
- 首次排名
- 首次成交额

**查询功能**：
- 今日新公司
- 最近7天新公司
- 最近30天新公司
- 全部历史记录

### 统计分析

**可分析维度**：
- 每日新进入数量
- 行业分布
- 平均排名
- 平均成交额
- 涨跌幅分布

---

## 🚀 使用方法

### 1. 自动运行

```bash
# 启动服务器
npm run dev

# 自动执行：
# 1. 获取Top 30
# 2. 检测新公司
# 3. 显示在页面
```

### 2. 手动刷新

```
点击"刷新数据"按钮
→ 重新检测Top 30
→ 更新新进入公司
```

### 3. 查看历史

```
历史记录文件：
data/top30-history.json

可以手动查看或分析
```

---

## 🔄 更新机制

### 实时更新

```
每次运行：
1. 获取最新Top 30
2. 对比历史记录
3. 识别新公司
4. 更新历史文件
5. 展示在页面
```

### 持久化存储

```
历史记录：
- 存储在本地文件
- 不会丢失
- 可以累积
- 支持分析
```

---

## 💡 最佳实践

### 1. 每日运行

```
建议：每天至少运行一次
目的：及时发现新进入的公司
时间：开盘前或盘中
```

### 2. 重点关注

```
关注指标：
- 涨幅 > 5%
- 成交额 > 50亿
- 排名 < 20
- 有重大新闻
```

### 3. 深入研究

```
发现新公司后：
1. 查看业务描述
2. 了解A股映射
3. 阅读新闻总结
4. 分析涨跌原因
5. 决定是否跟进
```

---

## 📁 文件结构

```
us-china-stock-agent/
├── lib/
│   └── history-tracker.ts          # 历史追踪器
├── app/
│   └── api/
│       └── new-entrants/
│           └── route.ts             # API端点
├── data/
│   ├── .gitignore                   # Git忽略
│   └── top30-history.json          # 历史记录（自动生成）
└── NEW_ENTRANTS_FEATURE.md         # 本文档
```

---

## ✅ 功能清单

**已实现**：
- ✅ 历史追踪器
- ✅ 新公司检测
- ✅ API端点
- ✅ 前端展示
- ✅ 完整分析
- ✅ 涨跌幅排序
- ✅ 独立板块
- ✅ 绿色主题

**特色功能**：
- ✅ 自动检测
- ✅ 持久化存储
- ✅ 完整分析
- ✅ AI新闻总结
- ✅ A股映射
- ✅ 独立展示

---

## 🎊 总结

**核心价值**：
- 🌟 发现市场新星
- 📊 追踪异常活跃
- 💡 及时投资机会
- ⚠️ 风险警示

**使用简单**：
- 自动检测
- 自动展示
- 无需配置

**分析完整**：
- 业务描述
- A股映射
- 新闻总结
- 涨跌幅排序

立即刷新页面，发现市场新星！🚀
